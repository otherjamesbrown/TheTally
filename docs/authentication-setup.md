# Authentication Setup Guide

## Overview

This guide explains how to authenticate with Google Cloud Platform for TheTally development and deployment.

## Authentication Methods

### 1. gcloud CLI Authentication (Required)

**For Development & Local Infrastructure:**
```bash
# Authenticate with your Google account
gcloud auth login

# Set the project
gcloud config set project jamesbr-thetally

# Verify authentication
gcloud auth list
```

**For CI/CD (GitHub Actions):**
- Service account keys (generated by setup script)
- No API keys needed for the application

## What You Need

### ✅ Required
- **Google Cloud Account** with billing enabled
- **gcloud CLI** installed and authenticated
- **Project ID**: `jamesbr-thetally` (already created)

### ❌ Not Required
- **API Keys** for the application
- **OAuth credentials** for the application
- **Service account keys** for local development

## Step-by-Step Setup

### 1. Install gcloud CLI
```bash
# macOS (using Homebrew)
brew install google-cloud-sdk

# Or download from: https://cloud.google.com/sdk/docs/install
```

### 2. Authenticate
```bash
# Login to your Google account
gcloud auth login

# Set the project
gcloud config set project jamesbr-thetally

# Verify everything is working
gcloud projects describe jamesbr-thetally
```

### 3. Enable Billing (if not already done)
1. Go to [Google Cloud Console](https://console.cloud.google.com/billing)
2. Select project `jamesbr-thetally`
3. Enable billing if not already enabled

### 4. Run Infrastructure Setup
```bash
# This will create all necessary resources
./scripts/setup-infrastructure.sh
```

## Configuration Files

### Project Configuration
- **`config/project-config.yaml`** - Project-wide settings
- **`config/environments/development.yaml`** - Development settings
- **`config/environments/production.yaml`** - Production settings

### Environment Variables
- **`.env.development`** - Local development
- **`.env.production`** - Production deployment
- **`.env.local`** - Local infrastructure

## Environment Management

### Development Environment
```bash
# Configure development environment
./scripts/configure-environment.sh development setup

# Start development services
./scripts/configure-environment.sh development deploy
```

### Production Environment
```bash
# Configure production environment
./scripts/configure-environment.sh production setup

# Deploy to production
./scripts/configure-environment.sh production deploy
```

### Local Infrastructure
```bash
# Configure local environment
./scripts/configure-environment.sh local setup

# Start local services
./scripts/configure-environment.sh local deploy
```

## Service Accounts

The setup script will create these service accounts:

1. **`thetally-app@jamesbr-thetally.iam.gserviceaccount.com`**
   - For application runtime
   - Access to Cloud Storage and Secret Manager

2. **`thetally-cicd@jamesbr-thetally.iam.gserviceaccount.com`**
   - For CI/CD pipeline
   - Access to Cloud Run and Artifact Registry

3. **`thetally-db@jamesbr-thetally.iam.gserviceaccount.com`**
   - For database access
   - Access to Compute Engine

## Security Best Practices

### For Development
- Use your personal Google account
- Enable 2FA on your Google account
- Use `gcloud auth login` for authentication

### For Production
- Use service accounts with minimal permissions
- Rotate service account keys regularly
- Store secrets in Secret Manager

### For CI/CD
- Use service account keys (stored in GitHub Secrets)
- Limit key permissions to only what's needed
- Rotate keys regularly

## Troubleshooting

### Common Issues

**1. "Project not found" error**
```bash
# Check if you're authenticated
gcloud auth list

# Check if project exists
gcloud projects list

# Set the correct project
gcloud config set project jamesbr-thetally
```

**2. "Permission denied" error**
```bash
# Check your permissions
gcloud projects get-iam-policy jamesbr-thetally

# Ensure you have Owner or Editor role
```

**3. "Billing not enabled" error**
- Go to [Google Cloud Console](https://console.cloud.google.com/billing)
- Enable billing for the project

### Getting Help

**Check authentication status:**
```bash
gcloud auth list
gcloud config list
```

**Check project access:**
```bash
gcloud projects describe jamesbr-thetally
```

**Check API access:**
```bash
gcloud services list --enabled
```

## Next Steps

After authentication is set up:

1. **Run infrastructure setup**: `./scripts/setup-infrastructure.sh`
2. **Configure environment**: `./scripts/configure-environment.sh production setup`
3. **Start development**: Follow the prompts in `docs/prompts.md`

## Security Notes

- **Never commit** service account keys to version control
- **Use Secret Manager** for sensitive configuration
- **Rotate keys** regularly (every 90 days)
- **Monitor access** using Cloud Audit Logs

---

*This authentication setup will work for both GCP and local infrastructure deployments.*
